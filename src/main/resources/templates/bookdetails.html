<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>书籍详情</title>
    <style type="text/css">
        /* 基础样式 */
        .page-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 130px;
            background-color: #ffeef2;
            padding: 30px 0;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            margin-bottom: 15px;
        }

        .sidebar-nav a {
            display: block;
            padding: 10px 30px;
            color: #333;
            text-decoration: none;
        }

        .sidebar-nav a:hover {
            background-color: #ffd9e2;
        }

        .main-content {
            flex: 1;
            padding: 30px;
        }

        .book-detail-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            color: #0066cc;
            text-decoration: none;
        }

        .book-basic-info {
            display: flex;
            gap: 40px;
            margin-bottom: 30px;
        }

        .book-main-image img {
            width: 300px;
            height: 400px;
            object-fit: cover;
            border-radius: 8px;
        }

        .book-title {
            font-size: 28px;
            margin-bottom: 20px;
        }

        .book-meta p {
            margin: 10px 0;
        }

        .price-tag {
            font-size: 32px;
            color: #e74c3c;
            margin: 20px 0;
            font-weight: bold;
        }

        .action-buttons {
            margin-top: 30px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-right: 10px;
        }

        .btn-success {
            background-color: #28a745;
            color: white;
        }

        .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .section-title {
            font-size: 20px;
            margin: 30px 0 15px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }

        .image-gallery {
            display: flex;
            gap: 10px;
        }

        .gallery-image img {
            width: 150px;
            height: 150px;
            object-fit: cover;
        }

        .seller-info {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="page-container">
    <aside class="sidebar">
        <ul class="sidebar-nav">
            <li><a th:href="@{/button}" class="active">首页</a></li>
            <li><a th:href="@{/my-page}">我的</a></li>
            <li><a th:href="@{/message-board}">留言板</a></li>
        </ul>
    </aside>

    <main class="main-content">
        <div class="book-detail-container">
            <a href="#" th:href="@{/buybooks}" class="back-link">
                ← 返回书籍列表
            </a>

            <div class="book-basic-info">
                <div class="book-main-image">
                    <img th:src="@{/images/logo.jpg}" alt="书籍主图" th:alt="${book.bookname}">
                </div>

                <div class="book-info">
                    <h2 class="book-title" th:text="${book.bookname}">书籍名称</h2>
                    <div class="book-meta">
                        <p><span>价格：</span><span th:text="${book.price}">0</span> 元</p>
                        <p><span>卖家ID：</span><span th:text="${book.sellerId}">0</span></p>
                        <p><span>发布时间：</span>
                            <span th:if="${book.created_time != null}"
                                  th:text="${#temporals.format(book.created_time, 'yyyy-MM-dd')}">
                                2023-01-01
                            </span>
                            <span th:unless="${book.created_time != null}">未知</span>
                        </p>
                    </div>

                    <div class="price-tag">¥<span th:text="${book.price}">0</span></div>

                    <div class="action-buttons">
                        <button id="buyBtn" class="btn btn-success">购买</button>
                        <a href="#" class="btn btn-primary">联系卖家</a>
                    </div>
                </div>
            </div>

            <div class="more-images">
                <h3 class="section-title">书籍封面</h3>
                <div class="image-gallery">
                    <div class="gallery-image">
                        <img th:src="@{/images/logo.jpg}" alt="书籍封面">
                    </div>
                </div>
            </div>

            <div class="seller-message">
                <h3 class="section-title">书籍描述</h3>
                <div class="message-content">
                    二手书籍，保存完好，欢迎购买。
                </div>
            </div>

            <div class="seller-info">
                <h3 class="section-title">卖家信息</h3>
                <p><span>用户名：</span><span th:text="${sellerStudent.nickname ?: '未知'}">未知卖家</span></p>
                <p><span>交易次数：</span><span th:text="${sellerStudent.sales_times ?: 0}">0</span> 次</p>
            </div>
        </div>
    </main>
</div>

<script>
    const buyBtn = document.getElementById('buyBtn');

    buyBtn.addEventListener('click', function() {
        const inputPassword = prompt('请输入购买密码（即您的账号密码）：');
        if (!inputPassword) {
            alert('已取消购买');
            return;
        }

        // 使用表单提交而不是 fetch API
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/purchase';

        const bookIdInput = document.createElement('input');
        bookIdInput.type = 'hidden';
        bookIdInput.name = 'bookId';
        bookIdInput.value = /*[[${book.id}]]*/ 0;

        const passwordInput = document.createElement('input');
        passwordInput.type = 'hidden';
        passwordInput.name = 'password';
        passwordInput.value = inputPassword;

        form.appendChild(bookIdInput);
        form.appendChild(passwordInput);
        document.body.appendChild(form);
        form.submit();
    });
</script>
</body>
</html>